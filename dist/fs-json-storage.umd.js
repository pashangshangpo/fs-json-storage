!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("fs"),require("path")):"function"==typeof define&&define.amd?define(["fs","path"],e):n.fsJsonStorage=e(n.fs,n.path)}(this,function(n,e){n=n&&n.hasOwnProperty("default")?n.default:n,e=e&&e.hasOwnProperty("default")?e.default:e;var t,r=(function(t,r){function o(n){return n&&"object"==typeof n&&"default"in n?n.default:n}var i=o(n),u=o(e);const c=function(){function n(){}return n.prototype.then=function(e,t){const r=new n,o=this.s;if(o){const n=1&o?e:t;if(n){try{f(r,1,n(this.v))}catch(n){f(r,2,n)}return r}return this}return this.o=function(n){try{const o=n.v;1&n.s?f(r,1,e?e(o):o):t?f(r,1,t(o)):f(r,2,o)}catch(n){f(r,2,n)}},r},n}();function f(n,e,t){if(!n.s){if(t instanceof c){if(!t.s)return void(t.o=f.bind(null,n,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(f.bind(null,n,e),f.bind(null,n,2));n.s=e,n.v=t;const r=n.o;r&&r(n)}}function s(n){return n instanceof c&&1&n.s}const l="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function a(n,e,t){if("function"==typeof n[l]){var r,o,i,u=n[l]();if(function n(l){try{for(;!((r=u.next()).done||t&&t());)if((l=e(r.value))&&l.then){if(!s(l))return void l.then(n,i||(i=f.bind(null,o=new c,2)));l=l.v}o?f(o,1,l):o=l}catch(n){f(o||(o=new c),2,n)}}(),u.return){var a=function(n){try{r.done||u.return()}catch(n){}return n};if(o&&o.then)return o.then(a,function(n){throw a(n)});a()}return o}if(!("length"in n))throw new TypeError("Object is not iterable");for(var h=[],m=0;m<n.length;m++)h.push(n[m]);return function(n,e,t){var r,o,i=-1;return function u(l){try{for(;++i<n.length&&(!t||!t());)if((l=e(i))&&l.then){if(!s(l))return void l.then(u,o||(o=f.bind(null,r=new c,2)));l=l.v}r?f(r,1,l):r=l}catch(n){f(r||(r=new c),2,n)}}(),r}(h,function(n){return e(h[n])},t)}"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var h=function(n){return new Promise(function(e){i.access(n,i.constants.F_OK,function(n){e(!n)})})},m=function(n){return new Promise(function(e){i.stat(n,function(n,t){e(!n&&t.isDirectory())})})},v=function(n){return new Promise(function(e){i.readdir(n,function(n,t){e(t||[])})})},d=function(n){try{var e=n.split("/");return e.pop(),Promise.resolve(h(e.join("/"))).then(function(t){function r(){return new Promise(function(e){i.mkdir(n,function(){try{return Promise.resolve(h(n)).then(function(n){e(n)})}catch(n){return Promise.reject(n)}})})}var o=function(){if(!t)return Promise.resolve(d(e.join("/"))).then(function(){})}();return o&&o.then?o.then(r):r()})}catch(n){return Promise.reject(n)}},y=function(n){return new Promise(function(e){i.unlink(n,function(n){e(!n)})})},p=function(n){try{return Promise.resolve(v(n)).then(function(e){function t(){return new Promise(function(e){i.rmdir(n,function(n){e(!n)})})}var r=a(e,function(e){var t=u.join(n,e);return Promise.resolve(m(t)).then(function(n){var e=n?Promise.resolve(p(t)).then(function(){}):Promise.resolve(y(t)).then(function(){});if(e&&e.then)return e.then(function(){})})});return r&&r.then?r.then(t):t()})}catch(n){return Promise.reject(n)}};r.exists=h,r.isDir=m,r.writeFile=function(n,e){try{var t=n.split("/");t.pop();var r=t.join("/");return Promise.resolve(h(r)).then(function(t){function o(){return new Promise(function(t){i.writeFile(n,e,function(n){t(!n)})})}var u=function(){if(!t)return Promise.resolve(d(r)).then(function(){})}();return u&&u.then?u.then(o):o()})}catch(n){return Promise.reject(n)}},r.writeJson=function(n,e){try{var t=n.split("/");t.pop();var r=t.join("/");return Promise.resolve(h(r)).then(function(t){function o(){return new Promise(function(t){i.writeFile(n,JSON.stringify(e,null,2),function(n){t(!n)})})}var u=function(){if(!t)return Promise.resolve(d(r)).then(function(){})}();return u&&u.then?u.then(o):o()})}catch(n){return Promise.reject(n)}},r.readdir=v,r.readFile=function(n){return new Promise(function(e){i.readFile(n,function(n,t){e(n?null:t)})})},r.readText=function(n){return new Promise(function(e){i.readFile(n,function(n,t){e(n?null:t.toString())})})},r.readJson=function(n){return new Promise(function(e){i.readFile(n,function(n,t){(t=t.toString()||null)&&(t=JSON.parse(t)),e(n?null:t)})})},r.mkdir=d,r.deleteDir=p,r.deleteFile=y}(t={exports:{}},t.exports),t.exports);return function(n){var e=[],t=[],o=!1,i=!1,u=function(){try{return Promise.resolve(r.exists(n)).then(function(e){return e?r.readJson(n):null})}catch(n){return Promise.reject(n)}},c=function(e){return r.writeJson(n,e)},f=function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];try{return o?(e.unshift(f.bind.apply(f,[null].concat(n))),Promise.resolve()):(o=!0,Promise.resolve(u()).then(function(t){if(t=t||{},2===n.length)t[n[0]]=n[1];else if(1===n.length)"[object object]"===Object.prototype.toString.call(n[0]).toLowerCase()&&(t=n[0]);else for(var r=0,i=n;r<i.length;r+=1){var u=i[r];t[u[0]]=u[1]}return Promise.resolve(c(t)).then(function(n){return o=!1,e.length&&e.pop()(),n})}))}catch(n){return Promise.reject(n)}},s=function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];try{return i?(t.unshift(s.bind.apply(s,[null].concat(n))),Promise.resolve()):(i=!0,Promise.resolve(u()).then(function(e){return e||(e=[]),e.push.apply(e,n),Promise.resolve(c(e)).then(function(n){return i=!1,t.length&&t.pop()(),n})}))}catch(n){return Promise.reject(n)}};return{get:function(n){try{return Promise.resolve(u()).then(function(e){return e?null!=n?e[n]||null:e:null})}catch(n){return Promise.reject(n)}},set:f,add:s,remove:function(e){try{return Promise.resolve(u()).then(function(t){if(t)return e?(delete t[e],c(t)):r.deleteFile(n)})}catch(n){return Promise.reject(n)}},empty:function(){return r.deleteFile(n)},find:function(n){try{return Promise.resolve(u()).then(function(e){return e&&Array.isArray(e)?e.filter(n):[]})}catch(n){return Promise.reject(n)}}}}});
