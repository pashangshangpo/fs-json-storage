import n from"fs";import t from"path";var e,r=(function(e,r){function o(n){return n&&"object"==typeof n&&"default"in n?n.default:n}var i=o(n),u=o(t);const c=function(){function n(){}return n.prototype.then=function(t,e){const r=new n,o=this.s;if(o){const n=1&o?t:e;if(n){try{f(r,1,n(this.v))}catch(n){f(r,2,n)}return r}return this}return this.o=function(n){try{const o=n.v;1&n.s?f(r,1,t?t(o):o):e?f(r,1,e(o)):f(r,2,o)}catch(n){f(r,2,n)}},r},n}();function f(n,t,e){if(!n.s){if(e instanceof c){if(!e.s)return void(e.o=f.bind(null,n,t));1&t&&(t=e.s),e=e.v}if(e&&e.then)return void e.then(f.bind(null,n,t),f.bind(null,n,2));n.s=t,n.v=e;const r=n.o;r&&r(n)}}function s(n){return n instanceof c&&1&n.s}const l="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function a(n,t,e){if("function"==typeof n[l]){var r,o,i,u=n[l]();if(function n(l){try{for(;!((r=u.next()).done||e&&e());)if((l=t(r.value))&&l.then){if(!s(l))return void l.then(n,i||(i=f.bind(null,o=new c,2)));l=l.v}o?f(o,1,l):o=l}catch(n){f(o||(o=new c),2,n)}}(),u.return){var a=function(n){try{r.done||u.return()}catch(n){}return n};if(o&&o.then)return o.then(a,function(n){throw a(n)});a()}return o}if(!("length"in n))throw new TypeError("Object is not iterable");for(var h=[],m=0;m<n.length;m++)h.push(n[m]);return function(n,t,e){var r,o,i=-1;return function u(l){try{for(;++i<n.length&&(!e||!e());)if((l=t(i))&&l.then){if(!s(l))return void l.then(u,o||(o=f.bind(null,r=new c,2)));l=l.v}r?f(r,1,l):r=l}catch(n){f(r||(r=new c),2,n)}}(),r}(h,function(n){return t(h[n])},e)}"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var h=function(n){return new Promise(function(t){i.access(n,i.constants.F_OK,function(n){t(!n)})})},m=function(n){return new Promise(function(t){i.stat(n,function(n,e){t(!n&&e.isDirectory())})})},v=function(n){return new Promise(function(t){i.readdir(n,function(n,e){t(e||[])})})},y=function(n){try{var t=n.split("/");return t.pop(),Promise.resolve(h(t.join("/"))).then(function(e){function r(){return new Promise(function(t){i.mkdir(n,function(){try{return Promise.resolve(h(n)).then(function(n){t(n)})}catch(n){return Promise.reject(n)}})})}var o=function(){if(!e)return Promise.resolve(y(t.join("/"))).then(function(){})}();return o&&o.then?o.then(r):r()})}catch(n){return Promise.reject(n)}},P=function(n){return new Promise(function(t){i.unlink(n,function(n){t(!n)})})},d=function(n){try{return Promise.resolve(v(n)).then(function(t){function e(){return new Promise(function(t){i.rmdir(n,function(n){t(!n)})})}var r=a(t,function(t){var e=u.join(n,t);return Promise.resolve(m(e)).then(function(n){var t=n?Promise.resolve(d(e)).then(function(){}):Promise.resolve(P(e)).then(function(){});if(t&&t.then)return t.then(function(){})})});return r&&r.then?r.then(e):e()})}catch(n){return Promise.reject(n)}};r.exists=h,r.isDir=m,r.writeFile=function(n,t){try{var e=n.split("/");e.pop();var r=e.join("/");return Promise.resolve(h(r)).then(function(e){function o(){return new Promise(function(e){i.writeFile(n,t,function(n){e(!n)})})}var u=function(){if(!e)return Promise.resolve(y(r)).then(function(){})}();return u&&u.then?u.then(o):o()})}catch(n){return Promise.reject(n)}},r.writeJson=function(n,t){try{var e=n.split("/");e.pop();var r=e.join("/");return Promise.resolve(h(r)).then(function(e){function o(){return new Promise(function(e){i.writeFile(n,JSON.stringify(t,null,2),function(n){e(!n)})})}var u=function(){if(!e)return Promise.resolve(y(r)).then(function(){})}();return u&&u.then?u.then(o):o()})}catch(n){return Promise.reject(n)}},r.readdir=v,r.readFile=function(n){return new Promise(function(t){i.readFile(n,function(n,e){t(n?null:e)})})},r.readText=function(n){return new Promise(function(t){i.readFile(n,function(n,e){t(n?null:e.toString())})})},r.readJson=function(n){return new Promise(function(t){i.readFile(n,function(n,e){(e=e.toString()||null)&&(e=JSON.parse(e)),t(n?null:e)})})},r.mkdir=y,r.deleteDir=d,r.deleteFile=P}(e={exports:{}},e.exports),e.exports);export default function(n){var t=[],e=[],o=!1,i=!1,u=function(){try{return Promise.resolve(r.exists(n)).then(function(t){return t?r.readJson(n):null})}catch(n){return Promise.reject(n)}},c=function(t){return r.writeJson(n,t)},f=function(){for(var n=[],e=arguments.length;e--;)n[e]=arguments[e];try{return o?(t.unshift(f.bind.apply(f,[null].concat(n))),Promise.resolve()):(o=!0,Promise.resolve(u()).then(function(e){if(e=e||{},2===n.length)e[n[0]]=n[1];else if(1===n.length)"[object object]"===Object.prototype.toString.call(n[0]).toLowerCase()&&(e=n[0]);else for(var r=0,i=n;r<i.length;r+=1){var u=i[r];e[u[0]]=u[1]}return Promise.resolve(c(e)).then(function(n){return o=!1,t.length&&t.pop()(),n})}))}catch(n){return Promise.reject(n)}},s=function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];try{return i?(e.unshift(s.bind.apply(s,[null].concat(n))),Promise.resolve()):(i=!0,Promise.resolve(u()).then(function(t){return t||(t=[]),t.push.apply(t,n),Promise.resolve(c(t)).then(function(n){return i=!1,e.length&&e.pop()(),n})}))}catch(n){return Promise.reject(n)}};return{get:function(n){try{return Promise.resolve(u()).then(function(t){return t?null!=n?t[n]||null:t:null})}catch(n){return Promise.reject(n)}},set:f,add:s,remove:function(t){try{return Promise.resolve(u()).then(function(e){if(e)return t?(delete e[t],c(e)):r.deleteFile(n)})}catch(n){return Promise.reject(n)}},empty:function(){return r.deleteFile(n)},find:function(n){try{return Promise.resolve(u()).then(function(t){return t&&Array.isArray(t)?t.filter(n):[]})}catch(n){return Promise.reject(n)}}}}
